fastlane_version "2.67.0"

default_platform :ios

platform :ios do
  before_all do
    setup_circle_ci
  end

  desc "Setup certificates"
  lane :certificates do
    match(app_identifier: ["de.integreat-app"])
  end

  desc "Create a simulator build"
  lane :build do
    xcbuild(
        workspace: "Integreat.xcworkspace",
        scheme: "Integreat",
        configuration: "Debug",
        xcargs: "-sdk iphonesimulator"
    )

    # scan(
    #     workspace: "Integreat.xcworkspace",
    #     scheme: "Integreat",
    #     configuration: "Debug",
    #     build_for_testing: true
    # )
  end

  desc "Create a simulator build"
  lane :release do
    sync_code_signing(type: "appstore")
    build_app(scheme: "Integreat", workspace: "Integreat.xcworkspace", include_bitcode: true)
  end

  desc "Upload to Browserstack"
  lane :browserstack_upload do
    upload_to_browserstack_app_live(
        browserstack_username: ENV["BROWSERSTACK_USERNAME"],
        browserstack_access_key: ENV["BROWSERSTACK_ACCESS_KEY"],
        file_path: "output/gym/Integreat.ipa"
    )
  end

  after_all do |lane|
  end

  error do |lane, exception|
  end
end
