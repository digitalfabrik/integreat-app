# Run checks and tests for native.
docker:
  - image: circleci/node:12.16.3
resource_class: small
environment:
  TOTAL_CPUS: 1 # For resource_class small
shell: /bin/bash -eo pipefail
steps:
  - skip_job
  - checkout
  - check_config
  - restore_yarn_cache
  - run:
      name: Linting check
      command: yarn workspace native lint
  - run:
      name: Flow-type check
      command: yarn workspace native flow:check-now --max-workers ${TOTAL_CPUS}
  - run:
      name: Unit tests
      command: yarn workspace native test --ci --maxWorkers ${TOTAL_CPUS}
  - run:
      name: Test coverage
      command: yarn workspace native test:coverage --ci --maxWorkers ${TOTAL_CPUS}
  - store_artifacts:
      path: native/coverage
      destination: native-coverage
  - run:
      name: Test coverage
      command: yarn workspace native api-client:coverage --ci --maxWorkers ${TOTAL_CPUS}
  - store_artifacts:
      path: api-client/coverage
      destination: api-client-coverage
  - notify_failed
