# Promote the app from the beta to the production track in the Google Play Store.
parameters:
  build_config_name:
    type: enum
    enum: [integreat, malte, aschaffenburg]
    default: integreat
docker:
  - image: circleci/android:api-29-node
resource_class: small
shell: /bin/bash -eo pipefail
environment:
  FASTLANE_SKIP_UPDATE_CHECK: true
steps:
  - skip_job:
      build_config_name: << parameters.build_config_name >>
  - checkout
  - prepare_workspace
  - restore_environment_variables
  - restore_yarn_tools_cache
  - restore_yarn_cache # Needed for babel-node run in read_build_config.rb. May be refactored and optimized later.
  - restore_ruby_cache:
      directory: native
  - run: # TODO don't fail if no beta version
      name: "[FL] Play Store Promotion"
      command: bundle exec fastlane android playstore_promote build_config_name:<< parameters.build_config_name >>
      working_directory: native
  - notify
