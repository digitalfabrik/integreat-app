# Run checks and tests.
docker:
  - image: cimg/node:18.14.1
resource_class: small
environment:
  TOTAL_CPUS: 1 # For resource_class small
  TZ: 'Europe/Berlin' # Should be removed in IGAPP-39
  NODE_OPTIONS: --max-old-space-size=1536
shell: /bin/bash -eo pipefail
steps:
  - checkout
  - skip_job
  - restore_yarn_cache
  - check_config
  - run:
      name: Prettier
      command: yarn prettier:check
  - run:
      name: Lint
      command: yarn :lint:ci
  - run:
      name: Stylelint
      command: yarn workspace web stylelint && yarn workspace web stylelint:css
  - run:
      name: TS check
      command: yarn workspaces foreach run tsc --build
  - run:
      name: TS check native
      command: yarn tsc --build
      working_directory: native
  - unit_test
